{"version":3,"file":"VizTooltipContainer.js","sources":["../../../../src/components/VizTooltip/VizTooltipContainer.tsx"],"sourcesContent":["import { css, cx } from '@emotion/css';\nimport React, { useState, HTMLAttributes, useMemo, useRef, useLayoutEffect } from 'react';\nimport { useWindowSize } from 'react-use';\n\nimport { Dimensions2D, GrafanaTheme2 } from '@grafana/data';\n\nimport { useStyles2 } from '../../themes';\nimport { getTooltipContainerStyles } from '../../themes/mixins';\n\nimport { calculateTooltipPosition } from './utils';\n\n/**\n * @public\n */\nexport interface VizTooltipContainerProps extends HTMLAttributes<HTMLDivElement> {\n  position: { x: number; y: number };\n  offset: { x: number; y: number };\n  children?: React.ReactNode;\n  allowPointerEvents?: boolean;\n}\n\n/**\n * @public\n */\nexport const VizTooltipContainer = ({\n  position: { x: positionX, y: positionY },\n  offset: { x: offsetX, y: offsetY },\n  children,\n  allowPointerEvents = false,\n  className,\n  ...otherProps\n}: VizTooltipContainerProps) => {\n  const tooltipRef = useRef<HTMLDivElement>(null);\n  const [tooltipMeasurement, setTooltipMeasurement] = useState<Dimensions2D>({ width: 0, height: 0 });\n  const { width, height } = useWindowSize();\n  const [placement, setPlacement] = useState({\n    x: positionX + offsetX,\n    y: positionY + offsetY,\n  });\n\n  const resizeObserver = useMemo(\n    () =>\n      // TS has hard time playing games with @types/resize-observer-browser, hence the ignore\n      // @ts-ignore\n      new ResizeObserver((entries) => {\n        for (let entry of entries) {\n          const tW = Math.floor(entry.contentRect.width + 2 * 8); //  adding padding until Safari supports borderBoxSize\n          const tH = Math.floor(entry.contentRect.height + 2 * 8);\n          if (tooltipMeasurement.width !== tW || tooltipMeasurement.height !== tH) {\n            setTooltipMeasurement({\n              width: Math.min(tW, width),\n              height: Math.min(tH, height),\n            });\n          }\n        }\n      }),\n    [tooltipMeasurement, width, height]\n  );\n\n  useLayoutEffect(() => {\n    if (tooltipRef.current) {\n      resizeObserver.observe(tooltipRef.current);\n    }\n\n    return () => {\n      resizeObserver.disconnect();\n    };\n  }, [resizeObserver]);\n\n  // Make sure tooltip does not overflow window\n  useLayoutEffect(() => {\n    if (tooltipRef && tooltipRef.current) {\n      const { x, y } = calculateTooltipPosition(\n        positionX,\n        positionY,\n        tooltipMeasurement.width,\n        tooltipMeasurement.height,\n        offsetX,\n        offsetY,\n        width,\n        height\n      );\n\n      setPlacement({ x, y });\n    }\n  }, [width, height, positionX, offsetX, positionY, offsetY, tooltipMeasurement]);\n\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div\n      ref={tooltipRef}\n      style={{\n        position: 'fixed',\n        left: 0,\n        // disabling pointer-events is to prevent the tooltip from flickering when moving left to right\n        // see e.g. https://github.com/grafana/grafana/pull/33609\n        pointerEvents: allowPointerEvents ? 'auto' : 'none',\n        top: 0,\n        transform: `translate(${placement.x}px, ${placement.y}px)`,\n        transition: 'transform ease-out 0.1s',\n      }}\n      aria-live=\"polite\"\n      aria-atomic=\"true\"\n      {...otherProps}\n      className={cx(styles.wrapper, className)}\n    >\n      {children}\n    </div>\n  );\n};\n\nVizTooltipContainer.displayName = 'VizTooltipContainer';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  wrapper: css(getTooltipContainerStyles(theme)),\n});\n"],"names":["React"],"mappings":"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"}