{"version":3,"file":"DataLinksInlineEditor.js","sources":["../../../../../src/components/DataLinks/DataLinksInlineEditor/DataLinksInlineEditor.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport { cloneDeep } from 'lodash';\nimport React, { useState } from 'react';\n\nimport { DataFrame, DataLink, GrafanaTheme2, VariableSuggestion } from '@grafana/data';\n\nimport { useStyles2 } from '../../../themes';\nimport { Button } from '../../Button/Button';\nimport { Modal } from '../../Modal/Modal';\n\nimport { DataLinkEditorModalContent } from './DataLinkEditorModalContent';\nimport { DataLinksListItem } from './DataLinksListItem';\n\ninterface DataLinksInlineEditorProps {\n  links?: DataLink[];\n  onChange: (links: DataLink[]) => void;\n  getSuggestions: () => VariableSuggestion[];\n  data: DataFrame[];\n}\n\nexport const DataLinksInlineEditor = ({ links, onChange, getSuggestions, data }: DataLinksInlineEditorProps) => {\n  const [editIndex, setEditIndex] = useState<number | null>(null);\n  const [isNew, setIsNew] = useState(false);\n\n  const styles = useStyles2(getDataLinksInlineEditorStyles);\n  const linksSafe: DataLink[] = links ?? [];\n  const isEditing = editIndex !== null;\n\n  const onDataLinkChange = (index: number, link: DataLink) => {\n    if (isNew) {\n      if (link.title.trim() === '' && link.url.trim() === '') {\n        setIsNew(false);\n        setEditIndex(null);\n        return;\n      } else {\n        setEditIndex(null);\n        setIsNew(false);\n      }\n    }\n    const update = cloneDeep(linksSafe);\n    update[index] = link;\n    onChange(update);\n    setEditIndex(null);\n  };\n\n  const onDataLinkAdd = () => {\n    let update = cloneDeep(linksSafe);\n    setEditIndex(update.length);\n    setIsNew(true);\n  };\n\n  const onDataLinkCancel = (index: number) => {\n    if (isNew) {\n      setIsNew(false);\n    }\n    setEditIndex(null);\n  };\n\n  const onDataLinkRemove = (index: number) => {\n    const update = cloneDeep(linksSafe);\n    update.splice(index, 1);\n    onChange(update);\n  };\n\n  return (\n    <>\n      {linksSafe.length > 0 && (\n        <div className={styles.wrapper}>\n          {linksSafe.map((l, i) => {\n            return (\n              <DataLinksListItem\n                key={`${l.title}/${i}`}\n                index={i}\n                link={l}\n                onChange={onDataLinkChange}\n                onEdit={() => setEditIndex(i)}\n                onRemove={() => onDataLinkRemove(i)}\n                data={data}\n              />\n            );\n          })}\n        </div>\n      )}\n\n      {isEditing && editIndex !== null && (\n        <Modal\n          title=\"Edit link\"\n          isOpen={true}\n          closeOnBackdropClick={false}\n          onDismiss={() => {\n            onDataLinkCancel(editIndex);\n          }}\n        >\n          <DataLinkEditorModalContent\n            index={editIndex}\n            link={isNew ? { title: '', url: '' } : linksSafe[editIndex]}\n            data={data}\n            onSave={onDataLinkChange}\n            onCancel={onDataLinkCancel}\n            getSuggestions={getSuggestions}\n          />\n        </Modal>\n      )}\n\n      <Button size=\"sm\" icon=\"plus\" onClick={onDataLinkAdd} variant=\"secondary\">\n        Add link\n      </Button>\n    </>\n  );\n};\n\nconst getDataLinksInlineEditorStyles = (theme: GrafanaTheme2) => ({\n  wrapper: css({\n    marginBottom: theme.spacing(2),\n  }),\n});\n"],"names":["React"],"mappings":"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"}