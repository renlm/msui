{"version":3,"file":"RowsList.js","sources":["../../../../src/components/Table/RowsList.tsx"],"sourcesContent":["import { css, cx } from '@emotion/css';\nimport React, { CSSProperties, UIEventHandler, useCallback, useEffect, useMemo, useState } from 'react';\nimport { Cell, Row, TableState, HeaderGroup } from 'react-table';\nimport { VariableSizeList } from 'react-window';\nimport { Subscription, debounceTime } from 'rxjs';\n\nimport {\n  DataFrame,\n  DataHoverClearEvent,\n  DataHoverEvent,\n  Field,\n  FieldType,\n  TimeRange,\n  hasTimeField,\n} from '@grafana/data';\nimport { TableCellDisplayMode, TableCellHeight } from '@grafana/schema';\n\nimport { useTheme2 } from '../../themes';\nimport CustomScrollbar from '../CustomScrollbar/CustomScrollbar';\nimport { usePanelContext } from '../PanelChrome';\n\nimport { ExpandedRow, getExpandedRowHeight } from './ExpandedRow';\nimport { TableCell } from './TableCell';\nimport { TableStyles } from './styles';\nimport { CellColors, TableFieldOptions, TableFilterActionCallback } from './types';\nimport {\n  calculateAroundPointThreshold,\n  getCellColors,\n  isPointTimeValAroundTableTimeVal,\n  guessTextBoundingBox,\n} from './utils';\n\ninterface RowsListProps {\n  data: DataFrame;\n  rows: Row[];\n  enableSharedCrosshair: boolean;\n  headerHeight: number;\n  rowHeight: number;\n  itemCount: number;\n  pageIndex: number;\n  listHeight: number;\n  width: number;\n  cellHeight?: TableCellHeight;\n  listRef: React.RefObject<VariableSizeList>;\n  tableState: TableState;\n  tableStyles: TableStyles;\n  nestedDataField?: Field;\n  prepareRow: (row: Row) => void;\n  onCellFilterAdded?: TableFilterActionCallback;\n  timeRange?: TimeRange;\n  footerPaginationEnabled: boolean;\n  initialRowIndex?: number;\n  headerGroups: HeaderGroup[];\n  longestField?: Field;\n}\n\nexport const RowsList = (props: RowsListProps) => {\n  const {\n    data,\n    rows,\n    headerHeight,\n    footerPaginationEnabled,\n    rowHeight,\n    itemCount,\n    pageIndex,\n    tableState,\n    prepareRow,\n    onCellFilterAdded,\n    width,\n    cellHeight = TableCellHeight.Sm,\n    timeRange,\n    tableStyles,\n    nestedDataField,\n    listHeight,\n    listRef,\n    enableSharedCrosshair = false,\n    initialRowIndex = undefined,\n    headerGroups,\n    longestField,\n  } = props;\n\n  const [rowHighlightIndex, setRowHighlightIndex] = useState<number | undefined>(initialRowIndex);\n  if (initialRowIndex === undefined && rowHighlightIndex !== undefined) {\n    setRowHighlightIndex(undefined);\n  }\n\n  const theme = useTheme2();\n  const panelContext = usePanelContext();\n\n  // Create off-screen canvas for measuring rows for virtualized rendering\n  // This line is like this because Jest doesn't have OffscreenCanvas mocked\n  // nor is it a part of the jest-canvas-mock package\n  let osContext = null;\n  if (window.OffscreenCanvas !== undefined) {\n    // The canvas size is defined arbitrarily\n    // As we never actually visualize rendered content\n    // from the offscreen canvas, only perform text measurements\n    osContext = new OffscreenCanvas(256, 1024).getContext('2d');\n  }\n\n  // Set font property using theme info\n  // This will make text measurement accurate\n  if (osContext !== undefined && osContext !== null) {\n    osContext.font = `${theme.typography.fontSize}px ${theme.typography.body.fontFamily}`;\n  }\n\n  const threshold = useMemo(() => {\n    const timeField = data.fields.find((f) => f.type === FieldType.time);\n\n    if (!timeField) {\n      return 0;\n    }\n\n    return calculateAroundPointThreshold(timeField);\n  }, [data]);\n\n  const onRowHover = useCallback(\n    (idx: number, frame: DataFrame) => {\n      if (!panelContext || !enableSharedCrosshair || !hasTimeField(frame)) {\n        return;\n      }\n\n      const timeField: Field = frame!.fields.find((f) => f.type === FieldType.time)!;\n\n      panelContext.eventBus.publish(\n        new DataHoverEvent({\n          point: {\n            time: timeField.values[idx],\n          },\n        })\n      );\n    },\n    [enableSharedCrosshair, panelContext]\n  );\n\n  const onRowLeave = useCallback(() => {\n    if (!panelContext || !enableSharedCrosshair) {\n      return;\n    }\n\n    panelContext.eventBus.publish(new DataHoverClearEvent());\n  }, [enableSharedCrosshair, panelContext]);\n\n  const onDataHoverEvent = useCallback(\n    (evt: DataHoverEvent) => {\n      if (evt.payload.point?.time && evt.payload.rowIndex !== undefined) {\n        const timeField = data.fields.find((f) => f.type === FieldType.time);\n        const time = timeField!.values[evt.payload.rowIndex];\n        const pointTime = evt.payload.point.time;\n\n        // If the time value of the hovered point is around the time value of the\n        // row with same index, highlight the row\n        if (isPointTimeValAroundTableTimeVal(pointTime, time, threshold)) {\n          setRowHighlightIndex(evt.payload.rowIndex);\n          return;\n        }\n\n        // If the time value of the hovered point is not around the time value of the\n        // row with same index, try to find a row with same time value\n        const matchedRowIndex = timeField!.values.findIndex((t) =>\n          isPointTimeValAroundTableTimeVal(pointTime, t, threshold)\n        );\n\n        if (matchedRowIndex !== -1) {\n          setRowHighlightIndex(matchedRowIndex);\n          return;\n        }\n\n        setRowHighlightIndex(undefined);\n      }\n    },\n    [data.fields, threshold]\n  );\n\n  useEffect(() => {\n    if (!panelContext || !enableSharedCrosshair || !hasTimeField(data) || footerPaginationEnabled) {\n      return;\n    }\n\n    const subs = new Subscription();\n\n    subs.add(\n      panelContext.eventBus\n        .getStream(DataHoverEvent)\n        .pipe(debounceTime(250))\n        .subscribe({\n          next: (evt) => {\n            if (panelContext.eventBus === evt.origin) {\n              return;\n            }\n\n            onDataHoverEvent(evt);\n          },\n        })\n    );\n\n    subs.add(\n      panelContext.eventBus\n        .getStream(DataHoverClearEvent)\n        .pipe(debounceTime(250))\n        .subscribe({\n          next: (evt) => {\n            if (panelContext.eventBus === evt.origin) {\n              return;\n            }\n\n            setRowHighlightIndex(undefined);\n          },\n        })\n    );\n\n    return () => {\n      subs.unsubscribe();\n    };\n  }, [data, enableSharedCrosshair, footerPaginationEnabled, onDataHoverEvent, panelContext]);\n\n  let scrollTop: number | undefined = undefined;\n  if (rowHighlightIndex !== undefined) {\n    const firstMatchedRowIndex = rows.findIndex((row) => row.index === rowHighlightIndex);\n\n    if (firstMatchedRowIndex !== -1) {\n      scrollTop = headerHeight + (firstMatchedRowIndex - 1) * rowHeight;\n    }\n  }\n\n  const rowIndexForPagination = useCallback(\n    (index: number) => {\n      return tableState.pageIndex * tableState.pageSize + index;\n    },\n    [tableState.pageIndex, tableState.pageSize]\n  );\n\n  let rowBg: Function | undefined = undefined;\n  let textWrapField: Field | undefined = undefined;\n  for (const field of data.fields) {\n    // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n    const fieldOptions = field.config.custom as TableFieldOptions;\n    const cellOptionsExist = fieldOptions !== undefined && fieldOptions.cellOptions !== undefined;\n\n    if (\n      cellOptionsExist &&\n      fieldOptions.cellOptions.type === TableCellDisplayMode.ColorBackground &&\n      fieldOptions.cellOptions.applyToRow\n    ) {\n      rowBg = (rowIndex: number): CellColors => {\n        const display = field.display!(field.values.get(rowIndex));\n        const colors = getCellColors(tableStyles, fieldOptions.cellOptions, display);\n        return colors;\n      };\n    }\n\n    if (\n      cellOptionsExist &&\n      (fieldOptions.cellOptions.type === TableCellDisplayMode.Auto ||\n        fieldOptions.cellOptions.type === TableCellDisplayMode.ColorBackground ||\n        fieldOptions.cellOptions.type === TableCellDisplayMode.ColorText) &&\n      fieldOptions.cellOptions.wrapText\n    ) {\n      textWrapField = field;\n    } else if (longestField !== undefined) {\n      textWrapField = longestField;\n    }\n  }\n\n  const RenderRow = useCallback(\n    ({ index, style, rowHighlightIndex }: { index: number; style: CSSProperties; rowHighlightIndex?: number }) => {\n      const indexForPagination = rowIndexForPagination(index);\n      const row = rows[indexForPagination];\n      let additionalProps: React.HTMLAttributes<HTMLDivElement> = {};\n      prepareRow(row);\n\n      const expandedRowStyle = tableState.expanded[row.id] ? css({ '&:hover': { background: 'inherit' } }) : {};\n\n      if (rowHighlightIndex !== undefined && row.index === rowHighlightIndex) {\n        style = { ...style, backgroundColor: theme.components.table.rowHoverBackground };\n        additionalProps = {\n          'aria-selected': 'true',\n        };\n      }\n\n      // Color rows if enabled\n      if (rowBg) {\n        const { bgColor, textColor } = rowBg(row.index);\n        style.background = bgColor;\n        style.color = textColor;\n      }\n\n      // If there's a text wrapping field we set the height of it here\n      if (textWrapField) {\n        const seriesIndex = data.fields.findIndex((field) => field.name === textWrapField.name);\n        const pxLineHeight = theme.typography.body.lineHeight * theme.typography.fontSize;\n        const bbox = guessTextBoundingBox(\n          textWrapField.values[index],\n          headerGroups[0].headers[seriesIndex],\n          osContext,\n          pxLineHeight,\n          tableStyles.rowHeight\n        );\n        style.height = bbox.height;\n      }\n\n      return (\n        <div\n          {...row.getRowProps({ style, ...additionalProps })}\n          className={cx(tableStyles.row, expandedRowStyle)}\n          onMouseEnter={() => onRowHover(index, data)}\n          onMouseLeave={onRowLeave}\n        >\n          {/*add the nested data to the DOM first to prevent a 1px border CSS issue on the last cell of the row*/}\n          {nestedDataField && tableState.expanded[row.id] && (\n            <ExpandedRow\n              nestedData={nestedDataField}\n              tableStyles={tableStyles}\n              // Using `row.index` ensures that we pick the correct row from the original data frame even when rows in\n              // the table are sorted, since `row.index` does not change when sorting.\n              rowIndex={row.index}\n              width={width}\n              cellHeight={cellHeight}\n            />\n          )}\n          {row.cells.map((cell: Cell, index: number) => (\n            <TableCell\n              key={index}\n              tableStyles={tableStyles}\n              cell={cell}\n              onCellFilterAdded={onCellFilterAdded}\n              columnIndex={index}\n              columnCount={row.cells.length}\n              timeRange={timeRange}\n              frame={data}\n              rowStyled={rowBg !== undefined}\n              textWrapped={textWrapField !== undefined}\n              height={Number(style.height)}\n            />\n          ))}\n        </div>\n      );\n    },\n    [\n      cellHeight,\n      data,\n      nestedDataField,\n      onCellFilterAdded,\n      onRowHover,\n      onRowLeave,\n      prepareRow,\n      rowIndexForPagination,\n      rows,\n      tableState.expanded,\n      tableStyles,\n      textWrapField,\n      theme.components.table.rowHoverBackground,\n      theme.typography.fontSize,\n      theme.typography.body.lineHeight,\n      timeRange,\n      width,\n      rowBg,\n      headerGroups,\n      osContext,\n    ]\n  );\n\n  const getItemSize = (index: number): number => {\n    const indexForPagination = rowIndexForPagination(index);\n    const row = rows[indexForPagination];\n\n    if (tableState.expanded[row.id] && nestedDataField) {\n      return getExpandedRowHeight(nestedDataField, row.index, tableStyles);\n    }\n\n    if (textWrapField) {\n      const seriesIndex = data.fields.findIndex((field) => field.name === textWrapField.name);\n      const pxLineHeight = theme.typography.fontSize * theme.typography.body.lineHeight;\n      return guessTextBoundingBox(\n        textWrapField.values[index],\n        headerGroups[0].headers[seriesIndex],\n        osContext,\n        pxLineHeight,\n        tableStyles.rowHeight\n      ).height;\n    }\n\n    return tableStyles.rowHeight;\n  };\n\n  const handleScroll: UIEventHandler = (event) => {\n    const { scrollTop } = event.currentTarget;\n\n    if (listRef.current !== null) {\n      listRef.current.scrollTo(scrollTop);\n    }\n  };\n\n  return (\n    <>\n      <CustomScrollbar onScroll={handleScroll} hideHorizontalTrack={true} scrollTop={scrollTop}>\n        <VariableSizeList\n          // This component needs an unmount/remount when row height or page changes\n          key={rowHeight + pageIndex}\n          height={listHeight}\n          itemCount={itemCount}\n          itemSize={getItemSize}\n          width={'100%'}\n          ref={listRef}\n          style={{ overflow: undefined }}\n        >\n          {({ index, style }) => RenderRow({ index, style, rowHighlightIndex })}\n        </VariableSizeList>\n      </CustomScrollbar>\n    </>\n  );\n};\n"],"names":["rowHighlightIndex","React","index","scrollTop"],"mappings":"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"}