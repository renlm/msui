{"version":3,"file":"hooks.js","sources":["../../../../src/components/Table/hooks.ts"],"sourcesContent":["import React, { useEffect } from 'react';\nimport { VariableSizeList } from 'react-window';\n\nimport { DataFrame } from '@grafana/data';\n\nimport { GrafanaTableState } from './types';\n\n/**\n  To have the custom vertical scrollbar always visible (https://github.com/grafana/grafana/issues/52136),\n  we need to bring the element from the VariableSizeList scope to the outer Table container scope,\n  because the VariableSizeList scope has overflow. By moving scrollbar to container scope we will have\n  it always visible since the entire width is in view.\n  Select the scrollbar element from the VariableSizeList scope\n */\nexport function useFixScrollbarContainer(\n  variableSizeListScrollbarRef: React.RefObject<HTMLDivElement>,\n  tableDivRef: React.RefObject<HTMLDivElement>\n) {\n  useEffect(() => {\n    if (variableSizeListScrollbarRef.current && tableDivRef.current) {\n      const listVerticalScrollbarHTML = variableSizeListScrollbarRef.current.querySelector('.track-vertical');\n\n      // Select Table custom scrollbars\n      const tableScrollbarView = tableDivRef.current.firstChild;\n\n      //If they exist, move the scrollbar element to the Table container scope\n      if (tableScrollbarView && listVerticalScrollbarHTML) {\n        listVerticalScrollbarHTML.remove();\n        if (tableScrollbarView instanceof HTMLElement) {\n          tableScrollbarView.querySelector(':scope > .track-vertical')?.remove();\n          tableScrollbarView.append(listVerticalScrollbarHTML);\n        }\n      }\n    }\n  });\n}\n\n/**\n  react-table caches the height of cells, so we need to reset them when expanding/collapsing rows.\n  We use `lastExpandedOrCollapsedIndex` since collapsed rows disappear from `expandedIndexes` but still keep their expanded\n  height.\n */\nexport function useResetVariableListSizeCache(\n  extendedState: GrafanaTableState,\n  listRef: React.RefObject<VariableSizeList>,\n  data: DataFrame,\n  hasUniqueId: boolean\n) {\n  // Make sure we trigger the reset when keys change in any way\n  const expandedRowsRepr = JSON.stringify(Object.keys(extendedState.expanded));\n\n  useEffect(() => {\n    // By default, reset all rows\n    let resetIndex = 0;\n\n    // If we have unique field, extendedState.expanded keys are not row indexes but IDs so instead of trying to search\n    // for correct index we just reset the whole table.\n    if (!hasUniqueId) {\n      // If we don't have we reset from the last changed index.\n      if (Number.isFinite(extendedState.lastExpandedOrCollapsedIndex)) {\n        resetIndex = extendedState.lastExpandedOrCollapsedIndex!;\n      }\n\n      // Account for paging.\n      resetIndex =\n        extendedState.pageIndex === 0\n          ? resetIndex - 1\n          : resetIndex - extendedState.pageIndex - extendedState.pageIndex * extendedState.pageSize;\n    }\n\n    listRef.current?.resetAfterIndex(Math.max(resetIndex, 0));\n    return;\n  }, [\n    extendedState.lastExpandedOrCollapsedIndex,\n    extendedState.pageSize,\n    extendedState.pageIndex,\n    listRef,\n    data,\n    expandedRowsRepr,\n    hasUniqueId,\n  ]);\n}\n"],"names":[],"mappings":";;AAcgB,SAAA,wBAAA,CACd,8BACA,WACA,EAAA;AACA,EAAA,SAAA,CAAU,MAAM;AAlBlB,IAAA,IAAA,EAAA,CAAA;AAmBI,IAAI,IAAA,4BAAA,CAA6B,OAAW,IAAA,WAAA,CAAY,OAAS,EAAA;AAC/D,MAAA,MAAM,yBAA4B,GAAA,4BAAA,CAA6B,OAAQ,CAAA,aAAA,CAAc,iBAAiB,CAAA,CAAA;AAGtG,MAAM,MAAA,kBAAA,GAAqB,YAAY,OAAQ,CAAA,UAAA,CAAA;AAG/C,MAAA,IAAI,sBAAsB,yBAA2B,EAAA;AACnD,QAAA,yBAAA,CAA0B,MAAO,EAAA,CAAA;AACjC,QAAA,IAAI,8BAA8B,WAAa,EAAA;AAC7C,UAAmB,CAAA,EAAA,GAAA,kBAAA,CAAA,aAAA,CAAc,0BAA0B,CAAA,KAA3D,IAA8D,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,MAAA,EAAA,CAAA;AAC9D,UAAA,kBAAA,CAAmB,OAAO,yBAAyB,CAAA,CAAA;AAAA,SACrD;AAAA,OACF;AAAA,KACF;AAAA,GACD,CAAA,CAAA;AACH,CAAA;AAOO,SAAS,6BACd,CAAA,aAAA,EACA,OACA,EAAA,IAAA,EACA,WACA,EAAA;AAEA,EAAA,MAAM,mBAAmB,IAAK,CAAA,SAAA,CAAU,OAAO,IAAK,CAAA,aAAA,CAAc,QAAQ,CAAC,CAAA,CAAA;AAE3E,EAAA,SAAA,CAAU,MAAM;AAnDlB,IAAA,IAAA,EAAA,CAAA;AAqDI,IAAA,IAAI,UAAa,GAAA,CAAA,CAAA;AAIjB,IAAA,IAAI,CAAC,WAAa,EAAA;AAEhB,MAAA,IAAI,MAAO,CAAA,QAAA,CAAS,aAAc,CAAA,4BAA4B,CAAG,EAAA;AAC/D,QAAA,UAAA,GAAa,aAAc,CAAA,4BAAA,CAAA;AAAA,OAC7B;AAGA,MACE,UAAA,GAAA,aAAA,CAAc,SAAc,KAAA,CAAA,GACxB,UAAa,GAAA,CAAA,GACb,aAAa,aAAc,CAAA,SAAA,GAAY,aAAc,CAAA,SAAA,GAAY,aAAc,CAAA,QAAA,CAAA;AAAA,KACvF;AAEA,IAAA,CAAA,EAAA,GAAA,OAAA,CAAQ,YAAR,IAAiB,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,eAAA,CAAgB,IAAK,CAAA,GAAA,CAAI,YAAY,CAAC,CAAA,CAAA,CAAA;AACvD,IAAA,OAAA;AAAA,GACC,EAAA;AAAA,IACD,aAAc,CAAA,4BAAA;AAAA,IACd,aAAc,CAAA,QAAA;AAAA,IACd,aAAc,CAAA,SAAA;AAAA,IACd,OAAA;AAAA,IACA,IAAA;AAAA,IACA,gBAAA;AAAA,IACA,WAAA;AAAA,GACD,CAAA,CAAA;AACH;;;;"}