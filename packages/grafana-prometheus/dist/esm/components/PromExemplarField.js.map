{"version":3,"file":"PromExemplarField.js","sources":["../../../src/components/PromExemplarField.tsx"],"sourcesContent":["// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/components/PromExemplarField.tsx\nimport { css, cx } from '@emotion/css';\nimport React, { useEffect, useState } from 'react';\nimport { usePrevious } from 'react-use';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { IconButton, InlineLabel, Tooltip, useStyles2 } from '@grafana/ui';\n\nimport { PrometheusDatasource } from '../datasource';\nimport { PromQuery } from '../types';\n\ninterface Props {\n  onChange: (exemplar: boolean) => void;\n  datasource: PrometheusDatasource;\n  query: PromQuery;\n  'data-testid'?: string;\n}\n\nexport function PromExemplarField({ datasource, onChange, query, ...rest }: Props) {\n  const [error, setError] = useState<string | null>(null);\n  const styles = useStyles2(getStyles);\n  const prevError = usePrevious(error);\n\n  useEffect(() => {\n    if (!datasource.exemplarsAvailable) {\n      setError('Exemplars for this query are not available');\n      onChange(false);\n    } else if (query.instant && !query.range) {\n      setError('Exemplars are not available for instant queries');\n      onChange(false);\n    } else {\n      setError(null);\n      // If error is cleared, we want to change exemplar to true\n      if (prevError && !error) {\n        onChange(true);\n      }\n    }\n  }, [datasource.exemplarsAvailable, query.instant, query.range, onChange, prevError, error]);\n\n  const iconButtonStyles = cx(\n    {\n      [styles.activeIcon]: !!query.exemplar,\n    },\n    styles.eyeIcon\n  );\n\n  return (\n    <InlineLabel width=\"auto\" data-testid={rest['data-testid']}>\n      <Tooltip content={error ?? ''}>\n        <div className={styles.iconWrapper}>\n          Exemplars\n          <IconButton\n            name=\"eye\"\n            tooltip={!!query.exemplar ? 'Disable query with exemplars' : 'Enable query with exemplars'}\n            disabled={!!error}\n            className={iconButtonStyles}\n            onClick={() => {\n              onChange(!query.exemplar);\n            }}\n          />\n        </div>\n      </Tooltip>\n    </InlineLabel>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    eyeIcon: css({\n      marginLeft: theme.spacing(2),\n    }),\n    activeIcon: css({\n      color: theme.colors.primary.main,\n    }),\n    iconWrapper: css({\n      display: 'flex',\n      alignItems: 'center',\n    }),\n  };\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAkBO,SAAS,kBAAkB,EAAiD,EAAA;AAAjD,EAAE,IAAA,EAAA,GAAA,EAAA,EAAA,EAAA,UAAA,EAAY,UAAU,KAlB1D,EAAA,GAkBkC,IAAkC,IAAlC,GAAA,SAAA,CAAA,EAAA,EAAkC,CAAhC,YAAA,EAAY,UAAU,EAAA,OAAA,CAAA,CAAA,CAAA;AACxD,EAAA,MAAM,CAAC,KAAA,EAAO,QAAQ,CAAA,GAAI,SAAwB,IAAI,CAAA,CAAA;AACtD,EAAM,MAAA,MAAA,GAAS,WAAW,SAAS,CAAA,CAAA;AACnC,EAAM,MAAA,SAAA,GAAY,YAAY,KAAK,CAAA,CAAA;AAEnC,EAAA,SAAA,CAAU,MAAM;AACd,IAAI,IAAA,CAAC,WAAW,kBAAoB,EAAA;AAClC,MAAA,QAAA,CAAS,4CAA4C,CAAA,CAAA;AACrD,MAAA,QAAA,CAAS,KAAK,CAAA,CAAA;AAAA,KACL,MAAA,IAAA,KAAA,CAAM,OAAW,IAAA,CAAC,MAAM,KAAO,EAAA;AACxC,MAAA,QAAA,CAAS,iDAAiD,CAAA,CAAA;AAC1D,MAAA,QAAA,CAAS,KAAK,CAAA,CAAA;AAAA,KACT,MAAA;AACL,MAAA,QAAA,CAAS,IAAI,CAAA,CAAA;AAEb,MAAI,IAAA,SAAA,IAAa,CAAC,KAAO,EAAA;AACvB,QAAA,QAAA,CAAS,IAAI,CAAA,CAAA;AAAA,OACf;AAAA,KACF;AAAA,GACF,EAAG,CAAC,UAAA,CAAW,kBAAoB,EAAA,KAAA,CAAM,OAAS,EAAA,KAAA,CAAM,KAAO,EAAA,QAAA,EAAU,SAAW,EAAA,KAAK,CAAC,CAAA,CAAA;AAE1F,EAAA,MAAM,gBAAmB,GAAA,EAAA;AAAA,IACvB;AAAA,MACE,CAAC,MAAO,CAAA,UAAU,GAAG,CAAC,CAAC,KAAM,CAAA,QAAA;AAAA,KAC/B;AAAA,IACA,MAAO,CAAA,OAAA;AAAA,GACT,CAAA;AAEA,EAAA,2CACG,WAAY,EAAA,EAAA,KAAA,EAAM,QAAO,aAAa,EAAA,IAAA,CAAK,aAAa,CACvD,EAAA,kBAAA,KAAA,CAAA,aAAA,CAAC,OAAQ,EAAA,EAAA,OAAA,EAAS,wBAAS,EACzB,EAAA,kBAAA,KAAA,CAAA,aAAA,CAAC,SAAI,SAAW,EAAA,MAAA,CAAO,eAAa,WAElC,kBAAA,KAAA,CAAA,aAAA;AAAA,IAAC,UAAA;AAAA,IAAA;AAAA,MACC,IAAK,EAAA,KAAA;AAAA,MACL,OAAS,EAAA,CAAC,CAAC,KAAA,CAAM,WAAW,8BAAiC,GAAA,6BAAA;AAAA,MAC7D,QAAA,EAAU,CAAC,CAAC,KAAA;AAAA,MACZ,SAAW,EAAA,gBAAA;AAAA,MACX,SAAS,MAAM;AACb,QAAS,QAAA,CAAA,CAAC,MAAM,QAAQ,CAAA,CAAA;AAAA,OAC1B;AAAA,KAAA;AAAA,GAEJ,CACF,CACF,CAAA,CAAA;AAEJ,CAAA;AAEA,SAAS,UAAU,KAAsB,EAAA;AACvC,EAAO,OAAA;AAAA,IACL,SAAS,GAAI,CAAA;AAAA,MACX,UAAA,EAAY,KAAM,CAAA,OAAA,CAAQ,CAAC,CAAA;AAAA,KAC5B,CAAA;AAAA,IACD,YAAY,GAAI,CAAA;AAAA,MACd,KAAA,EAAO,KAAM,CAAA,MAAA,CAAO,OAAQ,CAAA,IAAA;AAAA,KAC7B,CAAA;AAAA,IACD,aAAa,GAAI,CAAA;AAAA,MACf,OAAS,EAAA,MAAA;AAAA,MACT,UAAY,EAAA,QAAA;AAAA,KACb,CAAA;AAAA,GACH,CAAA;AACF;;;;"}