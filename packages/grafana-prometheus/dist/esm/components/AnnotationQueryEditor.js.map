{"version":3,"file":"AnnotationQueryEditor.js","sources":["../../../src/components/AnnotationQueryEditor.tsx"],"sourcesContent":["// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/components/AnnotationQueryEditor.tsx\nimport React from 'react';\n\nimport { AnnotationQuery } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { EditorField, EditorRow, EditorRows, EditorSwitch } from '@grafana/experimental';\nimport { AutoSizeInput, Input, Space } from '@grafana/ui';\n\nimport { PromQueryCodeEditor } from '../querybuilder/components/PromQueryCodeEditor';\nimport { PromQuery } from '../types';\n\nimport { PromQueryEditorProps } from './types';\n\ntype Props = PromQueryEditorProps & {\n  annotation?: AnnotationQuery<PromQuery>;\n  onAnnotationChange?: (annotation: AnnotationQuery<PromQuery>) => void;\n};\n\nexport function AnnotationQueryEditor(props: Props) {\n  // This is because of problematic typing. See AnnotationQueryEditorProps in grafana-data/annotations.ts.\n  const annotation = props.annotation!;\n  const onAnnotationChange = props.onAnnotationChange!;\n  const query = { expr: annotation.expr, refId: annotation.name, interval: annotation.step };\n\n  return (\n    <>\n      <EditorRows>\n        <PromQueryCodeEditor\n          {...props}\n          query={query}\n          showExplain={false}\n          onChange={(query) => {\n            onAnnotationChange({\n              ...annotation,\n              expr: query.expr,\n            });\n          }}\n        />\n        <EditorRow>\n          <EditorField\n            label=\"Min step\"\n            tooltip={\n              <>\n                An additional lower limit for the step parameter of the Prometheus query and for the{' '}\n                <code>$__interval</code> and <code>$__rate_interval</code> variables.\n              </>\n            }\n          >\n            <AutoSizeInput\n              type=\"text\"\n              aria-label=\"Set lower limit for the step parameter\"\n              placeholder={'auto'}\n              minWidth={10}\n              onCommitChange={(ev) => {\n                onAnnotationChange({\n                  ...annotation,\n                  step: ev.currentTarget.value,\n                });\n              }}\n              defaultValue={query.interval}\n              id={selectors.components.DataSource.Prometheus.annotations.minStep}\n            />\n          </EditorField>\n        </EditorRow>\n      </EditorRows>\n      <Space v={0.5} />\n      <EditorRow>\n        <EditorField\n          label=\"Title\"\n          tooltip={\n            'Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance.'\n          }\n        >\n          <Input\n            type=\"text\"\n            placeholder=\"{{alertname}}\"\n            value={annotation.titleFormat}\n            onChange={(event) => {\n              onAnnotationChange({\n                ...annotation,\n                titleFormat: event.currentTarget.value,\n              });\n            }}\n            data-testid={selectors.components.DataSource.Prometheus.annotations.title}\n          />\n        </EditorField>\n        <EditorField label=\"Tags\">\n          <Input\n            type=\"text\"\n            placeholder=\"label1,label2\"\n            value={annotation.tagKeys}\n            onChange={(event) => {\n              onAnnotationChange({\n                ...annotation,\n                tagKeys: event.currentTarget.value,\n              });\n            }}\n            data-testid={selectors.components.DataSource.Prometheus.annotations.tags}\n          />\n        </EditorField>\n        <EditorField\n          label=\"Text\"\n          tooltip={\n            'Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance.'\n          }\n        >\n          <Input\n            type=\"text\"\n            placeholder=\"{{instance}}\"\n            value={annotation.textFormat}\n            onChange={(event) => {\n              onAnnotationChange({\n                ...annotation,\n                textFormat: event.currentTarget.value,\n              });\n            }}\n            data-testid={selectors.components.DataSource.Prometheus.annotations.text}\n          />\n        </EditorField>\n        <EditorField\n          label=\"Series value as timestamp\"\n          tooltip={\n            'The unit of timestamp is milliseconds. If the unit of the series value is seconds, multiply its range vector by 1000.'\n          }\n        >\n          <EditorSwitch\n            value={annotation.useValueForTime}\n            onChange={(event) => {\n              onAnnotationChange({\n                ...annotation,\n                useValueForTime: event.currentTarget.value,\n              });\n            }}\n            data-testid={selectors.components.DataSource.Prometheus.annotations.seriesValueAsTimestamp}\n          />\n        </EditorField>\n      </EditorRow>\n    </>\n  );\n}\n"],"names":["query"],"mappings":"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"}