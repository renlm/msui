{"version":3,"file":"aggregations.js","sources":["../../../src/querybuilder/aggregations.ts"],"sourcesContent":["// Core Grafana history https://github.com/grafana/grafana/blob/v11.0.0-preview/public/app/plugins/datasource/prometheus/querybuilder/aggregations.ts\nimport {\n  createAggregationOperation,\n  createAggregationOperationWithParam,\n  getPromOperationDisplayName,\n  getRangeVectorParamDef,\n} from './operationUtils';\nimport { addOperationWithRangeVector } from './operations';\nimport { QueryBuilderOperation, QueryBuilderOperationDef } from './shared/types';\nimport { PromOperationId, PromVisualQueryOperationCategory } from './types';\n\nexport function getAggregationOperations(): QueryBuilderOperationDef[] {\n  return [\n    ...createAggregationOperation(PromOperationId.Sum),\n    ...createAggregationOperation(PromOperationId.Avg),\n    ...createAggregationOperation(PromOperationId.Min),\n    ...createAggregationOperation(PromOperationId.Max),\n    ...createAggregationOperation(PromOperationId.Count),\n    ...createAggregationOperationWithParam(PromOperationId.TopK, {\n      params: [{ name: 'K-value', type: 'number' }],\n      defaultParams: [5],\n    }),\n    ...createAggregationOperationWithParam(PromOperationId.BottomK, {\n      params: [{ name: 'K-value', type: 'number' }],\n      defaultParams: [5],\n    }),\n    ...createAggregationOperationWithParam(PromOperationId.CountValues, {\n      params: [{ name: 'Identifier', type: 'string' }],\n      defaultParams: ['count'],\n    }),\n    createAggregationOverTime(PromOperationId.SumOverTime),\n    createAggregationOverTime(PromOperationId.AvgOverTime),\n    createAggregationOverTime(PromOperationId.MinOverTime),\n    createAggregationOverTime(PromOperationId.MaxOverTime),\n    createAggregationOverTime(PromOperationId.CountOverTime),\n    createAggregationOverTime(PromOperationId.LastOverTime),\n    createAggregationOverTime(PromOperationId.PresentOverTime),\n    createAggregationOverTime(PromOperationId.AbsentOverTime),\n    createAggregationOverTime(PromOperationId.StddevOverTime),\n  ];\n}\n\nfunction createAggregationOverTime(name: string): QueryBuilderOperationDef {\n  return {\n    id: name,\n    name: getPromOperationDisplayName(name),\n    params: [getRangeVectorParamDef()],\n    defaultParams: ['$__interval'],\n    alternativesKey: 'overtime function',\n    category: PromVisualQueryOperationCategory.RangeFunctions,\n    renderer: operationWithRangeVectorRenderer,\n    addOperationHandler: addOperationWithRangeVector,\n  };\n}\n\nfunction operationWithRangeVectorRenderer(\n  model: QueryBuilderOperation,\n  def: QueryBuilderOperationDef,\n  innerExpr: string\n) {\n  let rangeVector = (model.params ?? [])[0] ?? '$__interval';\n  return `${def.id}(${innerExpr}[${rangeVector}])`;\n}\n"],"names":[],"mappings":";;;;AAWO,SAAS,wBAAuD,GAAA;AACrE,EAAO,OAAA;AAAA,IACL,GAAG,0BAA2B,CAAA,eAAA,CAAgB,GAAG,CAAA;AAAA,IACjD,GAAG,0BAA2B,CAAA,eAAA,CAAgB,GAAG,CAAA;AAAA,IACjD,GAAG,0BAA2B,CAAA,eAAA,CAAgB,GAAG,CAAA;AAAA,IACjD,GAAG,0BAA2B,CAAA,eAAA,CAAgB,GAAG,CAAA;AAAA,IACjD,GAAG,0BAA2B,CAAA,eAAA,CAAgB,KAAK,CAAA;AAAA,IACnD,GAAG,mCAAoC,CAAA,eAAA,CAAgB,IAAM,EAAA;AAAA,MAC3D,QAAQ,CAAC,EAAE,MAAM,SAAW,EAAA,IAAA,EAAM,UAAU,CAAA;AAAA,MAC5C,aAAA,EAAe,CAAC,CAAC,CAAA;AAAA,KAClB,CAAA;AAAA,IACD,GAAG,mCAAoC,CAAA,eAAA,CAAgB,OAAS,EAAA;AAAA,MAC9D,QAAQ,CAAC,EAAE,MAAM,SAAW,EAAA,IAAA,EAAM,UAAU,CAAA;AAAA,MAC5C,aAAA,EAAe,CAAC,CAAC,CAAA;AAAA,KAClB,CAAA;AAAA,IACD,GAAG,mCAAoC,CAAA,eAAA,CAAgB,WAAa,EAAA;AAAA,MAClE,QAAQ,CAAC,EAAE,MAAM,YAAc,EAAA,IAAA,EAAM,UAAU,CAAA;AAAA,MAC/C,aAAA,EAAe,CAAC,OAAO,CAAA;AAAA,KACxB,CAAA;AAAA,IACD,yBAAA,CAA0B,gBAAgB,WAAW,CAAA;AAAA,IACrD,yBAAA,CAA0B,gBAAgB,WAAW,CAAA;AAAA,IACrD,yBAAA,CAA0B,gBAAgB,WAAW,CAAA;AAAA,IACrD,yBAAA,CAA0B,gBAAgB,WAAW,CAAA;AAAA,IACrD,yBAAA,CAA0B,gBAAgB,aAAa,CAAA;AAAA,IACvD,yBAAA,CAA0B,gBAAgB,YAAY,CAAA;AAAA,IACtD,yBAAA,CAA0B,gBAAgB,eAAe,CAAA;AAAA,IACzD,yBAAA,CAA0B,gBAAgB,cAAc,CAAA;AAAA,IACxD,yBAAA,CAA0B,gBAAgB,cAAc,CAAA;AAAA,GAC1D,CAAA;AACF,CAAA;AAEA,SAAS,0BAA0B,IAAwC,EAAA;AACzE,EAAO,OAAA;AAAA,IACL,EAAI,EAAA,IAAA;AAAA,IACJ,IAAA,EAAM,4BAA4B,IAAI,CAAA;AAAA,IACtC,MAAA,EAAQ,CAAC,sBAAA,EAAwB,CAAA;AAAA,IACjC,aAAA,EAAe,CAAC,aAAa,CAAA;AAAA,IAC7B,eAAiB,EAAA,mBAAA;AAAA,IACjB,UAAU,gCAAiC,CAAA,cAAA;AAAA,IAC3C,QAAU,EAAA,gCAAA;AAAA,IACV,mBAAqB,EAAA,2BAAA;AAAA,GACvB,CAAA;AACF,CAAA;AAEA,SAAS,gCAAA,CACP,KACA,EAAA,GAAA,EACA,SACA,EAAA;AA3DF,EAAA,IAAA,EAAA,EAAA,EAAA,CAAA;AA4DE,EAAI,IAAA,WAAA,GAAA,CAAe,kBAAM,MAAN,KAAA,IAAA,GAAA,EAAA,GAAgB,EAAI,EAAA,CAAC,MAArB,IAA0B,GAAA,EAAA,GAAA,aAAA,CAAA;AAC7C,EAAA,OAAO,GAAG,GAAI,CAAA,EAAE,CAAI,CAAA,EAAA,SAAS,IAAI,WAAW,CAAA,EAAA,CAAA,CAAA;AAC9C;;;;"}