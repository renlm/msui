{"version":3,"file":"datasource.js","sources":["../../../src/utils/datasource.ts"],"sourcesContent":["import { isString } from 'lodash';\n\nimport {\n  DataSourcePluginOptionsEditorProps,\n  SelectableValue,\n  KeyValue,\n  DataSourceSettings,\n  DataSourceInstanceSettings,\n  DataSourceRef,\n  DataSourceJsonData,\n} from '../types';\n\n/**\n * Convert instance settings to a reference\n *\n * @public\n */\nexport function getDataSourceRef(ds: DataSourceInstanceSettings): DataSourceRef {\n  return { uid: ds.uid, type: ds.type };\n}\n\n/**\n * Returns true if the argument is a DataSourceRef\n *\n * @public\n */\nexport function isDataSourceRef(ref: DataSourceRef | string | null | undefined): ref is DataSourceRef {\n  return typeof ref === 'object' && typeof ref?.uid === 'string';\n}\n\n/**\n * Get the UID from a string of reference\n *\n * @public\n */\nexport function getDataSourceUID(ref: DataSourceRef | string | null): string | undefined {\n  if (isDataSourceRef(ref)) {\n    return ref.uid;\n  }\n  if (isString(ref)) {\n    return ref;\n  }\n  return undefined;\n}\n\nexport const onUpdateDatasourceOption =\n  (props: DataSourcePluginOptionsEditorProps, key: keyof DataSourceSettings) =>\n  (event: React.SyntheticEvent<HTMLInputElement | HTMLSelectElement>) => {\n    updateDatasourcePluginOption(props, key, event.currentTarget.value);\n  };\n\nexport const onUpdateDatasourceJsonDataOption =\n  <J extends DataSourceJsonData, S, K extends keyof J>(props: DataSourcePluginOptionsEditorProps<J, S>, key: K) =>\n  (event: React.SyntheticEvent<HTMLInputElement | HTMLSelectElement>) => {\n    updateDatasourcePluginJsonDataOption(props, key, event.currentTarget.value);\n  };\n\nexport const onUpdateDatasourceSecureJsonDataOption =\n  <J extends DataSourceJsonData, S extends {} = KeyValue>(\n    props: DataSourcePluginOptionsEditorProps<J, S>,\n    key: string\n  ) =>\n  (event: React.SyntheticEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\n    updateDatasourcePluginSecureJsonDataOption(props, key, event.currentTarget.value);\n  };\n\nexport const onUpdateDatasourceJsonDataOptionSelect =\n  <J extends DataSourceJsonData, S, K extends keyof J>(props: DataSourcePluginOptionsEditorProps<J, S>, key: K) =>\n  (selected: SelectableValue) => {\n    updateDatasourcePluginJsonDataOption(props, key, selected.value);\n  };\n\nexport const onUpdateDatasourceJsonDataOptionChecked =\n  <J extends DataSourceJsonData, S, K extends keyof J>(props: DataSourcePluginOptionsEditorProps<J, S>, key: K) =>\n  (event: React.SyntheticEvent<HTMLInputElement>) => {\n    updateDatasourcePluginJsonDataOption(props, key, event.currentTarget.checked);\n  };\n\nexport const onUpdateDatasourceSecureJsonDataOptionSelect =\n  <J extends DataSourceJsonData, S extends {} = KeyValue>(\n    props: DataSourcePluginOptionsEditorProps<J, S>,\n    key: string\n  ) =>\n  (selected: SelectableValue) => {\n    updateDatasourcePluginSecureJsonDataOption(props, key, selected.value);\n  };\n\nexport const onUpdateDatasourceResetOption =\n  (props: DataSourcePluginOptionsEditorProps, key: string) =>\n  (event: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\n    updateDatasourcePluginResetOption(props, key);\n  };\n\nexport function updateDatasourcePluginOption<J extends DataSourceJsonData, S extends {} = KeyValue>(\n  props: DataSourcePluginOptionsEditorProps<J, S>,\n  key: keyof DataSourceSettings,\n  val: unknown\n) {\n  const config = props.options;\n\n  props.onOptionsChange({\n    ...config,\n    [key]: val,\n  });\n}\n\nexport const updateDatasourcePluginJsonDataOption = <J extends DataSourceJsonData, S, K extends keyof J>(\n  props: DataSourcePluginOptionsEditorProps<J, S>,\n  key: K,\n  val: unknown\n) => {\n  const config = props.options;\n\n  props.onOptionsChange({\n    ...config,\n    jsonData: {\n      ...config.jsonData,\n      [key]: val,\n    },\n  });\n};\n\nexport const updateDatasourcePluginSecureJsonDataOption = <J extends DataSourceJsonData, S extends {} = KeyValue>(\n  props: DataSourcePluginOptionsEditorProps<J, S>,\n  key: string,\n  val: unknown\n) => {\n  const config = props.options;\n\n  props.onOptionsChange({\n    ...config,\n    secureJsonData: {\n      ...(config.secureJsonData ? config.secureJsonData : ({} as S)),\n      [key]: val,\n    },\n  });\n};\n\nexport const updateDatasourcePluginResetOption = <J extends DataSourceJsonData, S extends {} = KeyValue>(\n  props: DataSourcePluginOptionsEditorProps<J, S>,\n  key: string\n) => {\n  const config = props.options;\n  props.onOptionsChange({\n    ...config,\n    secureJsonData: {\n      ...(config.secureJsonData ? config.secureJsonData : ({} as S)),\n      [key]: '',\n    },\n    secureJsonFields: {\n      ...config.secureJsonFields,\n      [key]: false,\n    },\n  });\n};\n"],"names":[],"mappings":"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"}