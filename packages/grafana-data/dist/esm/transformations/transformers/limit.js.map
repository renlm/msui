{"version":3,"file":"limit.js","sources":["../../../../src/transformations/transformers/limit.ts"],"sourcesContent":["import { map } from 'rxjs/operators';\n\nimport { DataTransformerInfo } from '../../types';\n\nimport { DataTransformerID } from './ids';\nimport { transformationsVariableSupport } from './utils';\n\nexport interface LimitTransformerOptions {\n  limitField?: number | string;\n}\n\nconst DEFAULT_LIMIT_FIELD = 10;\n\nexport const limitTransformer: DataTransformerInfo<LimitTransformerOptions> = {\n  id: DataTransformerID.limit,\n  name: 'Limit',\n  description: 'Limit the number of items to the top N',\n  defaultOptions: {\n    limitField: DEFAULT_LIMIT_FIELD,\n  },\n\n  operator: (options, ctx) => (source) =>\n    source.pipe(\n      map((data) => {\n        let limit = DEFAULT_LIMIT_FIELD;\n        if (options.limitField !== undefined) {\n          if (typeof options.limitField === 'string') {\n            if (transformationsVariableSupport()) {\n              limit = parseInt(ctx.interpolate(options.limitField), 10);\n            } else {\n              limit = parseInt(options.limitField, 10);\n            }\n          } else {\n            limit = options.limitField;\n          }\n        }\n        return data.map((frame) => {\n          if (frame.length > limit) {\n            return {\n              ...frame,\n              fields: frame.fields.map((f) => {\n                return {\n                  ...f,\n                  values: f.values.slice(0, limit),\n                };\n              }),\n              length: limit,\n            };\n          }\n\n          return frame;\n        });\n      })\n    ),\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAWA,MAAM,mBAAsB,GAAA,EAAA,CAAA;AAErB,MAAM,gBAAiE,GAAA;AAAA,EAC5E,IAAI,iBAAkB,CAAA,KAAA;AAAA,EACtB,IAAM,EAAA,OAAA;AAAA,EACN,WAAa,EAAA,wCAAA;AAAA,EACb,cAAgB,EAAA;AAAA,IACd,UAAY,EAAA,mBAAA;AAAA,GACd;AAAA,EAEA,UAAU,CAAC,OAAA,EAAS,GAAQ,KAAA,CAAC,WAC3B,MAAO,CAAA,IAAA;AAAA,IACL,GAAA,CAAI,CAAC,IAAS,KAAA;AACZ,MAAA,IAAI,KAAQ,GAAA,mBAAA,CAAA;AACZ,MAAI,IAAA,OAAA,CAAQ,eAAe,KAAW,CAAA,EAAA;AACpC,QAAI,IAAA,OAAO,OAAQ,CAAA,UAAA,KAAe,QAAU,EAAA;AAC1C,UAAA,IAAI,gCAAkC,EAAA;AACpC,YAAA,KAAA,GAAQ,SAAS,GAAI,CAAA,WAAA,CAAY,OAAQ,CAAA,UAAU,GAAG,EAAE,CAAA,CAAA;AAAA,WACnD,MAAA;AACL,YAAQ,KAAA,GAAA,QAAA,CAAS,OAAQ,CAAA,UAAA,EAAY,EAAE,CAAA,CAAA;AAAA,WACzC;AAAA,SACK,MAAA;AACL,UAAA,KAAA,GAAQ,OAAQ,CAAA,UAAA,CAAA;AAAA,SAClB;AAAA,OACF;AACA,MAAO,OAAA,IAAA,CAAK,GAAI,CAAA,CAAC,KAAU,KAAA;AACzB,QAAI,IAAA,KAAA,CAAM,SAAS,KAAO,EAAA;AACxB,UAAA,OAAO,iCACF,KADE,CAAA,EAAA;AAAA,YAEL,MAAQ,EAAA,KAAA,CAAM,MAAO,CAAA,GAAA,CAAI,CAAC,CAAM,KAAA;AAC9B,cAAA,OAAO,iCACF,CADE,CAAA,EAAA;AAAA,gBAEL,MAAQ,EAAA,CAAA,CAAE,MAAO,CAAA,KAAA,CAAM,GAAG,KAAK,CAAA;AAAA,eACjC,CAAA,CAAA;AAAA,aACD,CAAA;AAAA,YACD,MAAQ,EAAA,KAAA;AAAA,WACV,CAAA,CAAA;AAAA,SACF;AAEA,QAAO,OAAA,KAAA,CAAA;AAAA,OACR,CAAA,CAAA;AAAA,KACF,CAAA;AAAA,GACH;AACJ;;;;"}